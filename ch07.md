# Chapter 7

The solution of the previous chapter is implemented in this chapter.
When navigating to the clients page, you should see a list of clients in a table and the possibility to add products. Make sure that the jworks demo backend app is running!

## Edit a client

By the end of this chapter, it should be possible to edit a product. Following will be added:

- A new function in our service to edit a client
- We will create a `EditClient` container component where we will create a callback function that calls the `editClient` function
from our client service. We will than pass this callback down to the `ClientForm` component to handle the form submission.
- We will also expand our `ClientForm` component, so that it can receive a `Client` as a prop, to prefill the form.
- Add the nessescary routing and changes to our `ClientsPage` component

### Update our products.ts service

Add the following function to `src/products/services/clients.ts`:

```jsx harmony
export const editClient = async (client: Partial<Client>): Promise<Client[]> =>
  (
    await fetch(`${apiUrl}/${client.id}`, {
      method: "PUT",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(client),
    })
  ).json();
```

### Create the EditProductDialog component

Create the component:

- `mkdir src/products/containers/EditProductDialog`
- `touch src/products/containers/EditProductDialog/EditProductDialog.tsx`

And paste the following:

```jsx harmony
import React, { useEffect, useState } from "react";
import { Product } from "../../types";
import { getProduct } from "../../services";
import { Dialog } from "../../../components";
import { ProductForm } from "../../components";
import { useRouteMatch } from "react-router-dom";

interface Props {
  onClose: () => void;
  onSubmit: (product: Product) => void;
}

export function EditProductDialog({ onSubmit, onClose }: Props) {
  const {
    params: { productId },
  } = useRouteMatch();
  const [product, setProduct] = (useState < Product) | (undefined > undefined);
  const retrieveProducts = async () => {
    const result = await getProduct(productId);
    setProduct(result);
  };

  useEffect(() => {
    retrieveProducts();
  }, []);

  return product ? (
    <Dialog show title="Edit product" onClose={onClose}>
      <ProductForm
        product={product}
        onSubmit={(productFields) => onSubmit({ ...product, ...productFields })}
      ></ProductForm>
    </Dialog>
  ) : null;
}
```

You an see we reuse our previous `ProductForm` component from ch06!

### Route to our EditProductDialog component

Make the following changes in `src/products/containers/ProductPage/ProductPage.tsx`:

```jsx harmony
...
import { CreateProductDialog, EditProductDialog /* NEW */ } from "../CreateProductDialog/CreateProductDialog";
...
export function ProductsPage() {
  ...
  return (
    <>
      ...
      <Page title="Products" onCreateButtonClick={() => push(`${url}/create`)}>
        <Table
          headers={["Id", "Name", "Description", "Product Code"]}
          data={products}
          onEdit={(productId) => push(`${url}/${productId}/edit`)} /* NEW */
          onDelete={() => {}}
        ></Table>
      </Page>
      ...
      <Route exact path={`${url}/:productId/edit`}>
        <EditProductDialog
          onClose={() => {}}
          onSubmit={() => {}}
        ></EditProductDialog>
      </Route>
    </>
  );
}
```

When clicking the "Edit" button, a dialog should apear with the text "ProducForm component".
Also when navigating directly to `http://localhost:3000/products/J1/edit` will open immidiatly the dialog component with the form filled in.

### Update our ProductPage container again

Finally we need actually call our service when the onSubmit button fires with the changed product.
Go to `src/products/containers/ProductPage/ProductPage.tsx` and change the following:

```jsx harmony
...
import { getProducts, addProduct, editProduct /* NEW */ } from "../../services";
...
export function ProductsPage() {
  ...
  const onEditProduct = async (newProduct: Partial<Product>) => {
    await editProduct(newProduct);
    await rehydrateProducts();
    push(url);
  };
  ...
  return (
    <>
      ...
      <Route exact path={`${url}/create`}>
        <EditProductDialog
          onClose={() => push(url)}
          {/* NEW */}
          onSubmit={onEditProduct}
        ></EditProductDialog>
      </Route>
    </>
  );
}
```
